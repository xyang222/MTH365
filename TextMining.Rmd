---
title: 'Section 13: Text Mining'
author: 'MTH 365: Introduction to Data Science'
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: pdf_document
---

## Recommended Reading

- _Tidy Text Mining with R_: Julia Silge and David Robinson (https://www.tidytextmining.com/)

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(mdsr)
library(RColorBrewer)
library(tidytext)
```

## Jeopardy!

__Example__: Reddit user u/PandaPython1 posted web scraped data from the Jeopardy Archive (http://www.jarchive.com) containing the questions, categories, answers, clue locations, and earnings from all Jeopardy shows through the 2017 season. The data is saved as `Jeopardy2017.csv`.

```{r}
Jeopardy2017 <- read.csv("Jeopardy2017.csv")
names(Jeopardy2017)
```

If you're a future Jeopardy contestant, you might want to limit your studying:

1. What categories are most common?
2. What types of answers are most common?

```{r}
Jeopardy2017 %>% summarize(n=n_distinct(categories))
```

Options: 

1. Review all 38,823 categories for classification manually
2. Use text mining!

__Text mining__: the process of deriving high-quality information from text.

## Most common categories and answers

What are the most common Jeopardy categories? Answers?

```{r}
category_df <- tibble(question=1:nrow(Jeopardy2017),
          category=as.character(Jeopardy2017$categories))
tidy_category <- category_df %>% 
  unnest_tokens(word, category) 
tidy_category %>% group_by(word) %>% 
  summarize(n=n())
```


```{r}
tidy_category %>% group_by(word) %>% 
  summarize(n=n()) %>% 
  arrange(desc(n))
```

How do we remove the "nuisance" words?

## Stop words

__Stop words__: usually means the most common, short function words, such as the, is, at, which, and on. Those words does not have a meaningful concept in the text thus we usually will avoid them in the text mining. 

```{r}
data(stop_words)
tidy_category <- tidy_category %>% anti_join(stop_words)
```

- What do you think `anti_join()` does?

> Answer: 

```{r}
tidy_category %>% group_by(word) %>% 
  summarize(n=n()) %>% 
  arrange(desc(n))
```

Now, back to the most common categories.

```{r}
top_categories <- tidy_category %>% group_by(word) %>% 
  summarize(n=n()) %>% 
  filter(n>=2000)
top_categories %>% ggplot(aes(x=word, y=n)) + 
  geom_col() + coord_flip()
```

Most Jeopardy categories aren't just one word.

__Bigram__: a pair of consecutive written units such as letters, syllables, or words.

```{r}
category_bigrams <- category_df %>%
  unnest_tokens(bigram, category, token = "ngrams", n = 2)
category_bigrams %>% group_by(bigram) %>% 
  summarize(n=n()) %>% arrange(desc(n))
```


```{r}
bigrams_separated <- category_bigrams %>%
  separate(bigram, c("word1", "word2"), sep = " ")

bigrams_filtered <- bigrams_separated %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word)

# new bigram counts:
bigram_counts <- bigrams_filtered %>% 
  count(word1, word2, sort = TRUE) %>% 
  filter(word1 != 'NA') %>% 
  filter(word2 != 'NA')
```


```{r}
bigram_counts
```


```{r}
top_bigrams <- bigram_counts %>% filter(n>=300) %>% mutate(bigram = paste(word1, ' ', word2))
top_bigrams %>% ggplot(aes(x=reorder(bigram, n), y=n)) + geom_col() + coord_flip()
```

What are the most common single-word question categories?

```{r}
Jeopardy2017 %>% summarize(n=n_distinct(categories))

question_df <- tibble(number=1:nrow(Jeopardy2017),
                      question=as.character(Jeopardy2017$question))
tidy_question <- question_df %>% unnest_tokens(word, question) 

tidy_question <- tidy_question %>% anti_join(stop_words)

top_questions <- tidy_question %>% group_by(word) %>% summarize(n=n()) %>% filter(n>=3000)
top_questions %>% ggplot(aes(x=reorder(word, n), y=n)) + geom_col() + coord_flip()
```

Based on bigrams, what are the most common categories?

```{r}
question_bigrams <- question_df %>%
  unnest_tokens(bigram, question, token = "ngrams", n = 2)

bigrams_separated <- question_bigrams %>%
  separate(bigram, c("word1", "word2"), sep = " ")

bigrams_filtered <- bigrams_separated %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word)

# new bigram counts:
bigram_counts <- bigrams_filtered %>% 
  count(word1, word2, sort = TRUE) %>% 
  filter(word1 != 'NA') %>% 
  filter(word2 != 'NA')

top_bigrams <- bigram_counts %>% filter(n>=300) %>% mutate(bigram = paste(word1, ' ', word2))
top_bigrams %>% ggplot(aes(x=reorder(bigram, n), y=n)) + geom_col() + coord_flip()
```

## Most common answers

Use text mining to investigate the most common Jeopardy answers. If you're planning an appearance on Jeopardy, what should you brush up on?

```{r}

```